---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const allDocuments = await getCollection('documents');
const publishedDocuments = allDocuments.filter((item) => item.data.published);

// Group documents by category
const documentsByCategory = publishedDocuments.reduce((acc, doc) => {
  const category = doc.data.category;
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(doc);
  return acc;
}, {} as Record<string, typeof publishedDocuments>);

// Sort categories
const categories = ['Governing Documents', 'Policies', 'Forms', 'Meeting Minutes', 'Other'] as const;
---

<BaseLayout title="Documents & Forms" description="Access HOA documents, forms, and meeting minutes">
  <div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-lg shadow-md p-8 mb-6">
      <h1 class="text-4xl font-bold text-gray-900 mb-4">Documents & Forms</h1>
      <p class="text-gray-700 mb-4">
        All official HOA documents, forms, and meeting minutes are available below. 
        Documents are organized by category for easy access.
      </p>
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
        <p class="text-sm text-gray-700">
          <strong>Note for Board Members:</strong> To add or update documents, edit the Markdown files 
          in the <code class="bg-white px-1 rounded">src/content/documents/</code> directory. 
          See the README for instructions.
        </p>
      </div>
    </div>

    {categories.map((category) => {
      const docs = documentsByCategory[category] || [];
      if (docs.length === 0) return null;

      return (
        <section class="bg-white rounded-lg shadow-md p-8 mb-6">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4">{category}</h2>
          <div class="space-y-4">
            {docs.map((doc) => (
              <div class="border-l-4 border-blue-500 pl-4 py-2">
                <h3 class="text-lg font-semibold text-gray-900 mb-1">
                  <a
                    href={doc.data.fileUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="hover:text-blue-600 transition-colors"
                  >
                    {doc.data.title}
                  </a>
                </h3>
                <p class="text-gray-600 text-sm mb-2">{doc.data.description}</p>
                {doc.data.effectiveDate && (
                  <p class="text-gray-500 text-xs">
                    Effective: {doc.data.effectiveDate.toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    })}
                  </p>
                )}
              </div>
            ))}
          </div>
        </section>
      );
    })}
  </div>
</BaseLayout>
