---
/**
 * Privacy-friendly analytics component
 *
 * Supports Plausible Analytics (legacy and new script).
 * To enable: PUBLIC_ANALYTICS_PROVIDER="plausible" and PUBLIC_PLAUSIBLE_DOMAIN set.
 * To use Plausible's new script: set PUBLIC_PLAUSIBLE_SCRIPT_SRC to the script URL
 * from Plausible → Site Settings → General → Site Installation.
 */

const analyticsProvider = import.meta.env.PUBLIC_ANALYTICS_PROVIDER || '';
const plausibleDomain = import.meta.env.PUBLIC_PLAUSIBLE_DOMAIN || '';
const plausibleScriptSrc = import.meta.env.PUBLIC_PLAUSIBLE_SCRIPT_SRC || '';

const isPlausibleEnabled = analyticsProvider === 'plausible' && plausibleDomain;
const useNewScript = plausibleScriptSrc.length > 0;
const scriptSrc = useNewScript ? plausibleScriptSrc : 'https://plausible.io/js/script.js';
// Legacy script has a known SRI hash; new script URL is unique per site so no SRI here
const legacyIntegrity = 'sha384-TDBMBYT3vz715r8UIyVTB4AUTXubXmLI02DeDWgyDahvCXmPV4Vgx2m6yQvI19d/';
---

{isPlausibleEnabled && (
  <script
    defer
    data-domain={plausibleDomain}
    src={scriptSrc}
    integrity={useNewScript ? undefined : legacyIntegrity}
    crossorigin="anonymous"
  />
)}
