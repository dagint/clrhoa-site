# Cloudflare Pages + D1/KV/R2 for CLR HOA portal
# Run: npx wrangler d1 create clrhoa_db
#      npx wrangler kv namespace create clrhoa_users
#      npx wrangler r2 bucket create clrhoa-files
# Then replace placeholder IDs below.
#
# ⚠️  SECRETS: Do NOT put secrets (API keys, tokens, passwords) in this file!
#     - For production: Use GitHub Secrets → GitHub Actions syncs to Cloudflare
#     - For local dev: Use .dev.vars (gitignored)
#     - See docs/GITHUB_SECRETS_SETUP.md for details
#     - To list required secrets: npm run secrets:list

name = "clrhoa-site"
compatibility_date = "2025-02-01"
compatibility_flags = ["nodejs_compat"]
pages_build_output_dir = "./dist"

# Bindings for Cloudflare Pages
# These apply to all Pages Functions (SSR routes)

# D1: portal users (email, role, name, created)
[[d1_databases]]
binding = "DB"
database_name = "clrhoa_db"
database_id = "66c2da44-c133-4e57-9352-e72637901cb4"

# KV: email whitelist (key = lowercase email, value = "1" or JSON { "role": "admin" })
[[kv_namespaces]]
binding = "CLRHOA_USERS"
id = "45ba5f4e64864c1eb5fcc7a6705b0a70"

# KV: SESSION storage for Lucia auth
[[kv_namespaces]]
binding = "SESSION"
id = "f2a5e8346928438baa1ca38e40ab200a"

# KV: rate limiting (API) and login lockout
[[kv_namespaces]]
binding = "KV"
id = "9249762b4c7b483a9785097db451f8e6"

# R2: portal files (redacted minutes, budgets)
[[r2_buckets]]
binding = "CLOURHOA_FILES"
bucket_name = "clrhoa-files"
