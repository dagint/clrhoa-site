# Cloudflare Pages + D1/KV/R2 for CLR HOA portal
# Run: npx wrangler d1 create clrhoa_db
#      npx wrangler kv namespace create clrhoa_users
#      npx wrangler r2 bucket create clrhoa-files
# Then replace placeholder IDs below. Set SESSION_SECRET via: npx wrangler secret put SESSION_SECRET
# Local dev: add SESSION_SECRET to .dev.vars

name = "clrhoa-site"
compatibility_date = "2025-02-01"
compatibility_flags = ["nodejs_compat"]

# D1: portal users (email, role, name, created)
[[d1_databases]]
binding = "DB"
database_name = "clrhoa_db"
database_id = "a214f9da-3577-4ee7-bc50-bc9b9754a79c"

# KV: email whitelist (key = lowercase email, value = "1" or JSON { "role": "admin" })
# id = the value printed when you ran: npx wrangler kv namespace create clrhoa_users
[[kv_namespaces]]
binding = "CLOURHOA_USERS"
id = "e936ea7760c04b268c4472eb24575d46"

# Adapter expects SESSION KV. id = from: npx wrangler kv namespace create SESSION
[[kv_namespaces]]
binding = "SESSION"
id = "f2a5e8346928438baa1ca38e40ab200a"

# R2: portal files (redacted minutes, budgets)
[[r2_buckets]]
binding = "CLOURHOA_FILES"
bucket_name = "clrhoa-files"

# SESSION_SECRET: set via wrangler secret put SESSION_SECRET (and .dev.vars for local)
